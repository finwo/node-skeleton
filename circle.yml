general:
  branches:
    only:
      - v2
machine:
  environment:
    GCLOUD_PROJECT: trackthis-169509

dependencies:
  pre:
  cache_directories:
    - "node_modules"
    - "bower_components"
  override:
    - npm install

deployment:
  production:
    branch: v2
    commands:
    # Authenticate with gcloud
    - echo $GCLOUD_SERVICE_KEY | base64 -di > ${HOME}/client-secret.json
    - gcloud auth activate-service-account --key-file ${HOME}/client-secret.json

    # Updates
    - yes | gcloud components update

    # Select project & deploy
    - gcloud config set project $GCLOUD_PROJECT
    - gcloud -q app deploy app.yaml --promote --version=v2
